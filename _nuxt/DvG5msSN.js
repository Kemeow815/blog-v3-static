import{_ as p,g as a,h as r,i as n,j as c,F as u,m as v,k as d,B as k,t as l,$ as w,l as f,D as I,a0 as b}from"#entry";const y=[{id:"1",content:"测试",location:"南京市",createdAt:"2025-09-11 12:30"},{id:"2",content:"测试图片",images:["https://imgbed.kemeow.top/file/pLwwWj8Y.jpg"],location:"南京市",createdAt:"2025-09-11 14:46"}],M=y.sort((s,t)=>new Date(t.createdAt).getTime()-new Date(s.createdAt).getTime()),x={name:"MomentsPage",data(){return{defaultAuthor:{name:"克喵爱吃卤面",avatar:"https://img.314926.xyz/images/2025/08/13/no-background-kemiaofxjun.webp",badges:["阁主"]},currentPage:1,pageSize:5,showPreview:!1,currentPhoto:"",currentPhotoIndex:0,currentMomentImages:[],keydownHandler:null}},computed:{sortedMoments(){return[...M].sort((s,t)=>new Date(t.createdAt).getTime()-new Date(s.createdAt).getTime()).map(s=>({...s,author:s.author||this.defaultAuthor}))},paginatedMoments(){const s=(this.currentPage-1)*this.pageSize;return this.sortedMoments.slice(s,s+this.pageSize)},totalPages(){return Math.ceil(this.sortedMoments.length/this.pageSize)}},mounted(){this.keydownHandler=s=>{this.showPreview&&(s.key==="Escape"?this.closePhotoPreview():s.key==="ArrowRight"?this.nextPhoto():s.key==="ArrowLeft"&&this.prevPhoto())},window.addEventListener("keydown",this.keydownHandler)},beforeUnmount(){this.keydownHandler&&(window.removeEventListener("keydown",this.keydownHandler),this.keydownHandler=null)},methods:{formatTime(s){return new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:"Asia/Shanghai"}).replace(/\//g,"-").replace(",","")},openPhotoPreview(s,t,_){this.currentPhoto=s,this.currentPhotoIndex=_,this.currentMomentImages=t,this.showPreview=!0},closePhotoPreview(){this.showPreview=!1},nextPhoto(){this.currentMomentImages.length>1&&(this.currentPhotoIndex=(this.currentPhotoIndex+1)%this.currentMomentImages.length,this.currentPhoto=this.currentMomentImages[this.currentPhotoIndex])},prevPhoto(){this.currentMomentImages.length>1&&(this.currentPhotoIndex=(this.currentPhotoIndex-1+this.currentMomentImages.length)%this.currentMomentImages.length,this.currentPhoto=this.currentMomentImages[this.currentPhotoIndex])}}},A={class:"moments-page"},C={class:"container"},z={class:"moments-grid"},D={class:"moment-header"},S={class:"author-info"},H={class:"author-main"},L={class:"author-name"},T={key:0,class:"badges-container"},B={class:"meta-info"},N={class:"moment-time"},j={key:0,class:"location-separator"},E={key:1,class:"location"},V={class:"moment-content"},F={class:"moment-text"},R={key:0,class:"pagination"},U=["disabled"],W={class:"page-info"},Y=["disabled"],Z={class:"preview-image-container"},q={key:0,class:"photo-counter"};function G(s,t,_,J,o,i){const g=k,m=I;return r(),a(u,null,[n("div",A,[n("div",C,[n("div",z,[(r(!0),a(u,null,v(i.paginatedMoments,e=>(r(),a("article",{key:e.id,class:"moment-card"},[n("div",D,[d(g,{src:e.author.avatar,alt:e.author.name,width:"44",height:"44",class:"author-avatar"},null,8,["src","alt"]),n("div",S,[n("div",H,[n("h3",L,l(e.author.name),1),e.author.badges?.length?(r(),a("div",T,[(r(!0),a(u,null,v(e.author.badges,h=>(r(),a("span",{key:h,class:"badge"},l(h),1))),128))])):c("",!0)]),n("div",B,[n("time",N,l(i.formatTime(e.createdAt)),1),e.location?(r(),a("span",j,"·")):c("",!0),e.location?(r(),a("span",E,l(e.location),1)):c("",!0)])])]),n("div",V,[n("p",F,l(e.content),1),e.images&&e.images.length>0?(r(),a("div",{key:0,class:w(["moment-images",{"single-image":e.images.length===1,"grid-images":e.images.length>1}])},[(r(!0),a(u,null,v(e.images,(h,P)=>(r(),f(g,{key:P,src:h,alt:`图片 ${P+1}`,class:w(["moment-image",{"grid-item":e.images.length>1}]),onClick:K=>i.openPhotoPreview(h,e.images,P)},null,8,["src","alt","class","onClick"]))),128))],2)):c("",!0)])]))),128))]),i.totalPages>1?(r(),a("div",R,[n("button",{disabled:o.currentPage===1,class:"pagination-btn",onClick:t[0]||(t[0]=e=>o.currentPage--)}," 上一页 ",8,U),n("span",W,"第 "+l(o.currentPage)+" 页 / 共 "+l(i.totalPages)+" 页",1),n("button",{disabled:o.currentPage===i.totalPages,class:"pagination-btn",onClick:t[1]||(t[1]=e=>o.currentPage++)}," 下一页 ",8,Y)])):c("",!0)])]),o.showPreview?(r(),a("div",{key:0,class:"photo-preview-modal",onClick:t[6]||(t[6]=(...e)=>i.closePhotoPreview&&i.closePhotoPreview(...e))},[n("div",{class:"preview-content",onClick:t[5]||(t[5]=b(()=>{},["stop"]))},[n("button",{class:"close-btn",onClick:t[2]||(t[2]=(...e)=>i.closePhotoPreview&&i.closePhotoPreview(...e))},[d(m,{name:"ph:x-bold"})]),n("div",Z,[o.currentMomentImages&&o.currentMomentImages.length>1?(r(),a("button",{key:0,class:"nav-btn prev-btn",onClick:t[3]||(t[3]=(...e)=>i.prevPhoto&&i.prevPhoto(...e))},[d(m,{name:"ph:caret-left-bold",size:"32"})])):c("",!0),d(g,{src:o.currentPhoto,alt:`即刻图片 ${o.currentPhotoIndex+1}`,class:"preview-image"},null,8,["src","alt"]),o.currentMomentImages&&o.currentMomentImages.length>1?(r(),a("button",{key:1,class:"nav-btn next-btn",onClick:t[4]||(t[4]=(...e)=>i.nextPhoto&&i.nextPhoto(...e))},[d(m,{name:"ph:caret-right-bold",size:"32"})])):c("",!0)]),o.currentMomentImages&&o.currentMomentImages.length>1?(r(),a("div",q,l(o.currentPhotoIndex+1)+" / "+l(o.currentMomentImages.length),1)):c("",!0)])])):c("",!0)],64)}const Q=p(x,[["render",G],["__scopeId","data-v-2689c44d"]]);export{Q as default};
